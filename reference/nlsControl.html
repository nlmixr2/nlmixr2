<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="nlmixr2 defaults controls for nls"><title>nlmixr2 defaults controls for nls — nlsControl • nlmixr2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="nlmixr2 defaults controls for nls — nlsControl"><meta property="og:description" content="nlmixr2 defaults controls for nls"><meta property="og:image" content="https://nlmixr2.github.io/nlmixr2/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nlmixr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fas fa fas fa-book"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/running_nlmixr.html">Introduction to Running Nlmixr</a>
    <a class="dropdown-item" href="../articles/multiple-endpoints.html">Using Multiple Endpoints in Nlmixr</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Going further</h6>
    <a class="dropdown-item" href="../articles/modelPiping.html">Model Piping</a>
    <a class="dropdown-item" href="../articles/broom.html">Sweeping models to tidy datasets (broom)</a>
    <a class="dropdown-item" href="../articles/censoring.html">Censoring in nlmixr2 (M3 and others)</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/xgxr-nlmixr-ggpmx.html">Integrated development with xgxr/nlmixr/ggPMX</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/citations.html">Citations of nlmixr2</a>
    <a class="dropdown-item" href="../articles/nlmixr2-team-and-advisory-committee.html">Who we are</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--example-models">
    <span class="fas fa fas fa-chalkboard-teacher"></span>
     
    Example models
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--example-models">
    <a class="dropdown-item" href="../articles/addingCovariances.html">Phenobarbatol with correlations</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/nimo.html">Nonlinear PK/PD -- Nimotuzumab</a>
    <a class="dropdown-item" href="../articles/mavoglurant.html">PBPK -- Mavoglurant</a>
    <a class="dropdown-item" href="../articles/wbc.html">PKPD -- Myelosuppression model</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/nlmixr2/raw/main/CheatSheet_nlmixr_220621.pdf">
    <span class="fa fa-scroll fa-lg"></span>
     
    Cheat Sheet
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://doi.org/10.1002/psp4.12445">
    <span class="fas fa fas fa-life-ring"></span>
     
    Tutorial
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o fa-lg"></span>
     
    Functions
  </a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/nlmixr2">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/nlmixr2/releases">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>nlmixr2 defaults controls for nls</h1>
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/nlmixr2/blob/HEAD/R/hardReexports.R" class="external-link"><code>R/hardReexports.R</code></a></small>
      <div class="d-none name"><code>nlsControl.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>nlmixr2 defaults controls for nls</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nlsControl</span><span class="op">(</span></span>
<span>  maxiter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  minFactor <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">1024</span>,</span>
<span>  printEval <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  warnOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scaleOffset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nDcentral <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LM"</span>, <span class="st">"default"</span>, <span class="st">"plinear"</span>, <span class="st">"port"</span><span class="op">)</span>,</span>
<span>  ftol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span>,</span>
<span>  ptol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span>,</span>
<span>  gtol <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  diag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  epsfcn <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  factor <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  maxfev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  nprint <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  solveType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grad"</span>, <span class="st">"fun"</span><span class="op">)</span>,</span>
<span>  stickyRecalcN <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  maxOdeRecalc <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  odeRecalcFactor <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  eventType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"central"</span>, <span class="st">"forward"</span><span class="op">)</span>,</span>
<span>  shiErr <span class="op">=</span> <span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  shi21maxFD <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  useColor <span class="op">=</span> <span class="fu">crayon</span><span class="fu">::</span><span class="fu"><a href="http://r-lib.github.io/crayon/reference/has_color.html" class="external-link">has_color</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  printNcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"width"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">23</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>  print <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  normType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rescale2"</span>, <span class="st">"mean"</span>, <span class="st">"rescale"</span>, <span class="st">"std"</span>, <span class="st">"len"</span>, <span class="st">"constant"</span><span class="op">)</span>,</span>
<span>  scaleType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nlmixr2"</span>, <span class="st">"norm"</span>, <span class="st">"mult"</span>, <span class="st">"multAdd"</span><span class="op">)</span>,</span>
<span>  scaleCmax <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  scaleCmin <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  scaleC <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scaleTo <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  gradTo <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rxControl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optExpression <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sumProd <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  literalFix <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  returnNls <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  addProp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"combined2"</span>, <span class="st">"combined1"</span><span class="op">)</span>,</span>
<span>  calcTables <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  adjObf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ci <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  sigdig <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sigdigTable <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>maxiter</dt>
<dd><p>A positive integer specifying the maximum number of
    iterations allowed.</p></dd>


<dt>tol</dt>
<dd><p>A positive numeric value specifying the tolerance level for
    the relative offset convergence criterion.</p></dd>


<dt>minFactor</dt>
<dd><p>A positive numeric value specifying the minimum
    step-size factor allowed on any step in the iteration.  The
    increment is calculated with a Gauss-Newton algorithm and
    successively halved until the residual sum of squares has been
    decreased or until the step-size factor has been reduced below this
    limit.</p></dd>


<dt>printEval</dt>
<dd><p>a logical specifying whether the number of evaluations
    (steps in the gradient direction taken each iteration) is printed.</p></dd>


<dt>warnOnly</dt>
<dd><p>a logical specifying whether <code><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a>()</code> should
    return instead of signalling an error in the case of termination
    before convergence.
    Termination before convergence happens upon completion of <code>maxiter</code>
    iterations, in the case of a singular gradient, and in the case that the
    step-size factor is reduced below <code>minFactor</code>.</p></dd>


<dt>scaleOffset</dt>
<dd><p>a constant to be added to the denominator of the relative
    offset convergence criterion calculation to avoid a zero divide in the case
    where the fit of a model to data is very close.  The default value of
    <code>0</code> keeps the legacy behaviour of <code><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls()</a></code>.  A value such as
    <code>1</code> seems to work for problems of reasonable scale with very small
    residuals.</p></dd>


<dt>nDcentral</dt>
<dd><p>only when <em>numerical</em> derivatives are used:
    <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></code> indicating if <em>central</em> differences
    should be employed, i.e., <code><a href="https://rdrr.io/r/stats/numericDeriv.html" class="external-link">numericDeriv</a>(*, central=TRUE)</code>
    be used.</p></dd>


<dt>algorithm</dt>
<dd><p>character string specifying the algorithm to use.
    The default algorithm is a Gauss-Newton algorithm.  Other possible
    values are <code>"plinear"</code> for the Golub-Pereyra algorithm for
    partially linear least-squares models and <code>"port"</code> for the
    ‘nl2sol’ algorithm from the Port library -- see the
    references.  Can be abbreviated.</p></dd>


<dt>ftol</dt>
<dd><p>non-negative numeric. Termination occurs when
      both the actual and predicted relative reductions in the sum of
      squares are at most <code>ftol</code>. Therefore, <code>ftol</code> measures
      the relative error desired in the sum of squares.</p></dd>


<dt>ptol</dt>
<dd><p>non-negative numeric. Termination occurs when
      the relative error between two consecutive iterates is at most
      <code>ptol</code>. Therefore, <code>ptol</code> measures the relative error
      desired in the approximate solution.</p></dd>


<dt>gtol</dt>
<dd><p>non-negative numeric. Termination occurs when
      the cosine of the angle between result of <code>fn</code> evaluation
      \(fvec\) and any column of the Jacobian is at most <code>gtol</code>
      in absolute value. Therefore, <code>gtol</code> measures the
      orthogonality desired between the function vector and the
      columns of the Jacobian.</p></dd>


<dt>diag</dt>
<dd><p>a list or numeric vector containing positive
      entries that serve as multiplicative scale factors for the
      parameters. Length of <code>diag</code> should be equal to that of
      <code>par</code>. If not, user-provided <code>diag</code> is ignored and
      <code>diag</code> is internally set.</p></dd>


<dt>epsfcn</dt>
<dd><p>(used if <code>jac</code> is not provided) is a
      numeric used in determining a suitable step for the
      forward-difference approximation. This approximation assumes
      that the relative errors in the functions are of the order of
      <code>epsfcn</code>. If <code>epsfcn</code> is less than the machine
      precision, it is assumed that the relative errors in the
      functions are of the order of the machine precision.</p></dd>


<dt>factor</dt>
<dd><p>positive numeric, used in determining the
      initial step bound.  This bound is set to the product of
      <code>factor</code> and the \(|\code{diag}*\code{par}|\) if nonzero,
      or else to <code>factor</code> itself. In most cases <code>factor</code>
      should lie in the interval (0.1,100). 100 is a generally
      recommended value.</p></dd>


<dt>maxfev</dt>
<dd><p>integer; termination occurs
      when the number of calls to <code>fn</code> has reached <code>maxfev</code>.
      Note that <code>nls.lm</code> sets the value of <code>maxfev</code> to 
      <code>100*(length(par) + 1)</code> if 
      <code>maxfev = integer()</code>, where <code>par</code> is the list or
      vector of parameters to be optimized.</p></dd>


<dt>nprint</dt>
<dd><p>is an integer; set <code>nprint</code> to be positive
      to enable printing of iterates</p></dd>


<dt>solveType</dt>
<dd><p>tells if `nlm` will use nlmixr2's analytical
  gradients when available (finite differences will be used for
  event-related parameters like parameters controlling lag time,
  duration/rate of infusion, and modeled bioavailability). This can
  be:</p>
<p>- `"hessian"` which will use the analytical gradients to create a
    Hessian with finite differences.</p>
<p>- `"gradient"` which will use the gradient and let `nlm` calculate
   the finite difference hessian</p>
<p>- `"fun"` where nlm will calculate both the finite difference
   gradient and the finite difference Hessian</p>
<p>When using nlmixr2's finite differences, the "ideal" step size for
 either central or forward differences are optimized for with the
 Shi2021 method which may give more accurate derivatives</p></dd>


<dt>stickyRecalcN</dt>
<dd><p>The number of bad ODE solves before reducing
the atol/rtol for the rest of the problem.</p></dd>


<dt>maxOdeRecalc</dt>
<dd><p>Maximum number of times to reduce the ODE
tolerances and try to resolve the system if there was a bad
ODE solve.</p></dd>


<dt>odeRecalcFactor</dt>
<dd><p>The ODE recalculation factor when ODE
solving goes bad, this is the factor the rtol/atol is reduced</p></dd>


<dt>eventType</dt>
<dd><p>Event gradient type for dosing events; Can be
"central" or "forward"</p></dd>


<dt>shiErr</dt>
<dd><p>This represents the epsilon when optimizing the ideal
step size for numeric differentiation using the Shi2021 method</p></dd>


<dt>shi21maxFD</dt>
<dd><p>The maximum number of steps for the optimization
of the forward difference step size when using dosing events (lag
time, modeled duration/rate and bioavailability)</p></dd>


<dt>useColor</dt>
<dd><p>Boolean indicating if focei can use ASCII color codes</p></dd>


<dt>printNcol</dt>
<dd><p>Number of columns to printout before wrapping
parameter estimates/gradient</p></dd>


<dt>print</dt>
<dd><p>Integer representing when the outer step is
printed. When this is 0 or do not print the iterations.  1 is
print every function evaluation (default), 5 is print every 5
evaluations.</p></dd>


<dt>normType</dt>
<dd><p>This is the type of parameter
    normalization/scaling used to get the scaled initial values
    for nlmixr2.  These are used with <code>scaleType</code> of.</p>
<p>With the exception of <code>rescale2</code>, these come
    from
    <a href="https://en.wikipedia.org/wiki/Feature_scaling" class="external-link">Feature
    Scaling</a>. The <code>rescale2</code> The rescaling is the same type
    described in the
    <a href="http://apmonitor.com/me575/uploads/Main/optimization_book.pdf" class="external-link">OptdesX</a>
    software manual.</p>
<p>In general, all all scaling formula can be described by:</p>
<p>$$v_{scaled}$$ = ($$v_{unscaled}-C_{1}$$)/$$C_{2}$$</p>

<p>Where</p>

<p>The other data normalization approaches follow the following formula</p>
<p>$$v_{scaled}$$ = ($$v_{unscaled}-C_{1}$$)/$$C_{2}$$</p>
<ul><li><p><code>rescale2</code> This scales all parameters from (-1 to 1).
    The relative differences between the parameters are preserved
    with this approach and the constants are:</p>
<p>$$C_{1}$$ = (max(all unscaled values)+min(all unscaled values))/2</p>
<p>$$C_{2}$$ = (max(all unscaled values) - min(all unscaled values))/2</p></li>
<li><p><code>rescale</code> or min-max normalization. This rescales all
    parameters from (0 to 1).  As in the <code>rescale2</code> the
    relative differences are preserved.  In this approach:</p>
<p>$$C_{1}$$ = min(all unscaled values)</p>
<p>$$C_{2}$$ = max(all unscaled values) - min(all unscaled values)</p></li>
<li><p><code>mean</code> or mean normalization.  This rescales to center
    the parameters around the mean but the parameters are from 0
    to 1.  In this approach:</p>
<p>$$C_{1}$$ = mean(all unscaled values)</p>
<p>$$C_{2}$$ = max(all unscaled values) - min(all unscaled values)</p></li>
<li><p><code>std</code> or standardization.  This standardizes by the mean
     and standard deviation.  In this approach:</p>
<p>$$C_{1}$$ = mean(all unscaled values)</p>
<p>$$C_{2}$$ = sd(all unscaled values)</p></li>
<li><p><code>len</code> or unit length scaling.  This scales the
   parameters to the unit length.  For this approach we use the Euclidean length, that
   is:</p>
<p>$$C_{1}$$ = 0</p>
<p>$$C_{2}$$ = $$\sqrt(v_1^2 + v_2^2 + \cdots + v_n^2)$$</p></li>
<li><p><code>constant</code> which does not perform data normalization. That is</p>
<p>$$C_{1}$$ = 0</p>
<p>$$C_{2}$$ = 1</p></li>
</ul></dd>


<dt>scaleType</dt>
<dd><p>The scaling scheme for nlmixr2.  The supported types are:</p>
<ul><li><p><code>nlmixr2</code>  In this approach the scaling is performed by the following equation:</p>
<p>$$v_{scaled}$$ = ($$v_{current} - v_{init}$$)*scaleC[i] + scaleTo</p>
<p>The <code>scaleTo</code> parameter is specified by the <code>normType</code>,
and the scales are specified by <code>scaleC</code>.</p></li>
<li><p><code>norm</code> This approach uses the simple scaling provided
    by the <code>normType</code> argument.</p></li>
<li><p><code>mult</code> This approach does not use the data
normalization provided by <code>normType</code>, but rather uses
multiplicative scaling to a constant provided by the <code>scaleTo</code>
argument.</p>
<p>In this case:</p>
<p>$$v_{scaled}$$ = $$v_{current}$$/$$v_{init}$$*scaleTo</p></li>
<li><p><code>multAdd</code> This approach changes the scaling based on
the parameter being specified.  If a parameter is defined in an
exponential block (ie exp(theta)), then it is scaled on a
linearly, that is:</p>
<p>$$v_{scaled}$$ = ($$v_{current}-v_{init}$$) + scaleTo</p>
<p>Otherwise the parameter is scaled multiplicatively.</p>
<p>$$v_{scaled}$$ = $$v_{current}$$/$$v_{init}$$*scaleTo</p></li>
</ul></dd>


<dt>scaleCmax</dt>
<dd><p>Maximum value of the scaleC to prevent overflow.</p></dd>


<dt>scaleCmin</dt>
<dd><p>Minimum value of the scaleC to prevent underflow.</p></dd>


<dt>scaleC</dt>
<dd><p>The scaling constant used with
    <code>scaleType=nlmixr2</code>.  When not specified, it is based on
    the type of parameter that is estimated.  The idea is to keep
    the derivatives similar on a log scale to have similar
    gradient sizes.  Hence parameters like log(exp(theta)) would
    have a scaling factor of 1 and log(theta) would have a scaling
    factor of ini_value (to scale by 1/value; ie
    d/dt(log(ini_value)) = 1/ini_value or scaleC=ini_value)</p>
<p></p><ul><li><p>For parameters in an exponential (ie exp(theta)) or
   parameters specifying powers, boxCox or yeoJohnson
   transformations , this is 1.</p></li>
<li><p>For additive, proportional, lognormal error structures,
   these are given by 0.5*abs(initial_estimate)</p></li>
<li><p>Factorials are scaled by abs(1/digamma(initial_estimate+1))</p></li>
<li><p>parameters in a log scale (ie log(theta)) are transformed
   by log(abs(initial_estimate))*abs(initial_estimate)</p></li>
</ul><p>These parameter scaling coefficients are chose to try to keep
   similar slopes among parameters.  That is they all follow the
   slopes approximately on a log-scale.</p>
<p>While these are chosen in a logical manner, they may not always
   apply.  You can specify each parameters scaling factor by this
   parameter if you wish.</p></dd>


<dt>scaleTo</dt>
<dd><p>Scale the initial parameter estimate to this value.
By default this is 1.  When zero or below, no scaling is performed.</p></dd>


<dt>gradTo</dt>
<dd><p>this is the factor that the gradient is scaled to
before optimizing.  This only works with
scaleType="nlmixr2".</p></dd>


<dt>trace</dt>
<dd><p>logical value indicating if a trace of the iteration
    progress should be printed.  Default is <code>FALSE</code>.  If
    <code>TRUE</code> the residual (weighted) sum-of-squares, the convergence
    criterion and the parameter values are printed at the conclusion of
    each iteration.  Note that <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a>()</code> is used, so these
    mostly depend on <code><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a>("digits")</code>.
    When the <code>"plinear"</code> algorithm is used, the conditional
    estimates of the linear parameters are printed after the nonlinear
    parameters.  When the <code>"port"</code> algorithm is used the
    objective function value printed is half the residual (weighted)
    sum-of-squares.</p></dd>


<dt>rxControl</dt>
<dd><p>`rxode2` ODE solving options during fitting, created with `rxControl()`</p></dd>


<dt>optExpression</dt>
<dd><p>Optimize the rxode2 expression to speed up
calculation. By default this is turned on.</p></dd>


<dt>sumProd</dt>
<dd><p>Is a boolean indicating if the model should change
multiplication to high precision multiplication and sums to
high precision sums using the PreciseSums package.  By default
this is <code>FALSE</code>.</p></dd>


<dt>literalFix</dt>
<dd><p>boolean, substitute fixed population values as
literals and re-adjust ui and parameter estimates after
optimization; Default is `TRUE`.</p></dd>


<dt>returnNls</dt>
<dd><p>logical; when TRUE, will return the nls object
instead of the nlmixr object</p></dd>


<dt>addProp</dt>
<dd><p>specifies the type of additive plus proportional
  errors, the one where standard deviations add (combined1) or the
  type where the variances add (combined2).</p>
<p>The combined1 error type can be described by the following equation:</p>
<p>$$y = f + (a + b\times f^c) \times \varepsilon$$</p>
<p>The combined2 error model can be described by the following equation:</p>
<p>$$y = f + \sqrt{a^2 + b^2\times f^{2\times c}} \times \varepsilon$$</p>
<p>Where:</p>
<p>- y represents the observed value</p>
<p>- f represents the predicted value</p>
<p>- a  is the additive standard deviation</p>
<p>- b is the proportional/power standard deviation</p>
<p>- c is the power exponent (in the proportional case c=1)</p></dd>


<dt>calcTables</dt>
<dd><p>This boolean is to determine if the foceiFit
will calculate tables. By default this is <code>TRUE</code></p></dd>


<dt>compress</dt>
<dd><p>Should the object have compressed items</p></dd>


<dt>adjObf</dt>
<dd><p>is a boolean to indicate if the objective function
should be adjusted to be closer to NONMEM's default objective
function.  By default this is <code>TRUE</code></p></dd>


<dt>ci</dt>
<dd><p>Confidence level for some tables.  By default this is
0.95 or 95% confidence.</p></dd>


<dt>sigdig</dt>
<dd><p>Optimization significant digits. This controls:</p>
<ul><li><p>The tolerance of the inner and outer optimization is <code>10^-sigdig</code></p></li>
<li><p>The tolerance of the ODE solvers is
 <code>0.5*10^(-sigdig-2)</code>; For the sensitivity equations and
 steady-state solutions the default is <code>0.5*10^(-sigdig-1.5)</code>
 (sensitivity changes only applicable for liblsoda)</p></li>
<li><p>The tolerance of the boundary check is <code>5 * 10 ^ (-sigdig + 1)</code></p></li>
</ul></dd>


<dt>sigdigTable</dt>
<dd><p>Significant digits in the final output table.
If not specified, then it matches the significant digits in the
`sigdig` optimization algorithm.  If `sigdig` is NULL, use 3.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to <code><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlsControl.html">nlmixr2est::nlsControl()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>nls control object</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Matthew L. Fidler</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">rxode2parse</span><span class="fu">::</span><span class="fu"><a href="https://nlmixr2.github.io/rxode2parse/reference/dot-linCmtSens.html" class="external-link">.linCmtSens</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">one.cmt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">tka</span> <span class="op">&lt;-</span> <span class="fl">0.45</span></span></span>
<span class="r-in"><span>   <span class="va">tcl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.7</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">tv</span> <span class="op">&lt;-</span> <span class="fl">3.45</span></span></span>
<span class="r-in"><span>   <span class="va">add.sd</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span></span>
<span class="r-in"><span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">ka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tka</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tcl</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tv</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu">linCmt</span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu">add</span><span class="op">(</span><span class="va">add.sd</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Uses nlsLM from minpack.lm if available</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html">nlmixr</a></span><span class="op">(</span><span class="va">one.cmt</span>, <span class="fu">nlmixr2data</span><span class="fu">::</span><span class="va"><a href="https://nlmixr2.github.io/nlmixr2data/reference/theo_sd.html">theo_sd</a></span>, est<span class="op">=</span><span class="st">"nls"</span>, <span class="fu">nlsControl</span><span class="op">(</span>algorithm<span class="op">=</span><span class="st">"LM"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Uses port and respect parameter boundaries</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html">nlmixr</a></span><span class="op">(</span><span class="va">one.cmt</span>, <span class="fu">nlmixr2data</span><span class="fu">::</span><span class="va"><a href="https://nlmixr2.github.io/nlmixr2data/reference/theo_sd.html">theo_sd</a></span>, est<span class="op">=</span><span class="st">"nls"</span>, <span class="fu">nlsControl</span><span class="op">(</span>algorithm<span class="op">=</span><span class="st">"port"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can access the underlying nls object with `$nls`</span></span></span>
<span class="r-in"><span><span class="va">fit2</span><span class="op">$</span><span class="va">nls</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → loading into <span style="color: #0000BB;">symengine</span> environment...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → pruning branches (`if`/`else`) of nls model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → calculate jacobian</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → calculate ∂(f)/∂(θ)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → finding duplicate expressions in nls gradient...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → optimizing duplicate expressions in nls gradient...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → finding duplicate expressions in nls pred-only...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → calculating covariance</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → loading into <span style="color: #0000BB;">symengine</span> environment...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → pruning branches (`if`/`else`) of full model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → finding duplicate expressions in EBE model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → optimizing duplicate expressions in EBE model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → compiling EBE model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → Calculating residuals/tables</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → compress origData in nlmixr2 object, save 5952</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → compress parHistData in nlmixr2 object, save 2320</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → loading into <span style="color: #0000BB;">symengine</span> environment...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → pruning branches (`if`/`else`) of nls model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → calculate jacobian</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → calculate ∂(f)/∂(θ)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → finding duplicate expressions in nls gradient...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → optimizing duplicate expressions in nls gradient...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → finding duplicate expressions in nls pred-only...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → loading into <span style="color: #0000BB;">symengine</span> environment...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → pruning branches (`if`/`else`) of full model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → finding duplicate expressions in EBE model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → optimizing duplicate expressions in EBE model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → compiling EBE model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → Calculating residuals/tables</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → compress origData in nlmixr2 object, save 5952</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → compress parHistData in nlmixr2 object, save 2296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Nonlinear regression model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   model: 0 ~ nlmixr2est::.nlmixrNlsFunValGrad(DV, tka, tcl, tv)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    data: nlmixr2est::.nlmixrNlsData()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tka     tcl      tv </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.0097 -0.6696  1.0423 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  residual sum-of-squares: 249.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Algorithm "port", convergence message: relative convergence (4)</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Fidler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

